# 🔬 Notion Entropy

> **热力学第二定律告诉我们：封闭系统的熵只增不减。**  
> 你的 Notion 知识库也是如此——定期检测，对抗熵增。

Notion Entropy 是一个知识库健康度检测工具，帮助你量化 Notion 工作区的信息混乱程度，及时发现需要整理的内容。

---

## ✨ 功能特性

### 📊 多维度熵增指标

| 指标 | 说明 | 健康范围 |
|------|------|---------|
| 🕐 **时间衰减熵** | 多窗口（30/90/150/300天）未更新页面占比 | 30天 < 30% |
| 📈 **活跃度** | 近 7/30/90 天更新的页面比例 | 30天 > 20% |
| 📝 **属性完整度** | 页面属性填写完整程度 | > 70% |
| 🏷️ **分类覆盖率** | 有分类标签的页面比例 | > 80% |
| 🔗 **连接密度** | 含 @mention 链接的页面比例 | > 30% |
| 🏥 **综合健康度** | 加权综合评分 (A-D) | ≥ 60分 |

### 🎯 核心能力

- **自动发现**：自动扫描所有可访问的 Notion 数据库
- **智能检测**：多维度分析信息的健康状态
- **详细报告**：生成 Markdown 格式的可视化报告
- **抽样优化**：对高成本指标采用抽样检测，控制 API 调用

---

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置 Notion Integration

1. 访问 https://www.notion.so/my-integrations
2. 点击 "New integration" 创建新集成
3. 获取 Integration Token（`secret_` 或 `ntn_` 开头）
4. 在 Notion 中将集成添加到需要监控的页面/数据库

### 3. 配置环境变量

创建 `.env` 文件：

```bash
# Notion Integration Token（必需）
NOTION_TOKEN=ntn_your_token_here

# 可选配置
DATABASE_IDS=              # 留空则监控所有，指定则用逗号分隔
TIME_DECAY_THRESHOLD_DAYS=30
TIME_DECAY_WARNING_THRESHOLD=40
```

### 4. 运行检测

```bash
python notion_entropy_checker.py
```

报告将保存在 `report/` 目录下。

---

## 📐 指标定义与计算方法

### 1. 时间衰减熵 (Time Decay Entropy)

**定义**：不同时间窗口下未更新的页面占比，多维度反映信息的"新鲜度"。

**时间窗口**：
| 窗口 | 说明 | 健康阈值 |
|------|------|---------|
| >30天 | 近期老化 | < 30% |
| >90天 | 季度老化 | < 50% |
| >150天 | 半年老化 | < 70% |
| >300天 | 年度老化 | < 85% |

**计算公式**：
```
时间衰减熵(N天) = (超过N天未更新的页面数 / 总页面数) × 100%
```

**数据来源**：页面的 `last_edited_time` 属性

**解读**：
- 关注 >300天 的页面：可能是废弃信息，考虑归档或删除
- 关注 >150天 的页面：需要审视是否仍有价值
- 30天衰减率用于计算健康度评分

---

### 2. 活跃度指标 (Activity Metrics)

**定义**：近期有更新的页面比例，反映知识库的活跃程度。

**计算公式**：
```
活跃率 = (近N天内更新的页面数 / 总页面数) × 100%
```

**时间范围**：
- 7天活跃率：反映即时活跃度
- 30天活跃率：反映月度活跃度（用于健康度评分）
- 90天活跃率：反映季度活跃度

---

### 3. 属性完整度 (Property Completeness)

**定义**：页面属性的填写完整程度，反映信息的结构化程度。

**计算公式**：
```
单页完整度 = (已填写属性数 / 总属性数) × 100%
平均完整度 = Σ(单页完整度) / 页面数
```

**检测的属性类型**：
- title, rich_text, number, select, multi_select
- date, url, email, phone_number, relation, files

**解读**：
- ≥ 80%：完整
- 30-80%：部分填写
- < 30%：基本为空

---

### 4. 分类覆盖率 (Categorization Coverage)

**定义**：有分类/标签的页面占比，反映信息组织的规范程度。

**计算公式**：
```
分类覆盖率 = (有分类的页面数 / 总页面数) × 100%
```

**判定为"有分类"的条件**（满足任一）：
- `select` 属性有值
- `multi_select` 属性有值
- `relation` 属性有值

---

### 5. 连接密度 (Link Density)

**定义**：页面中包含 @mention 链接的比例，反映知识网络的连通程度。

**计算方法**：
```
连接密度 = (含链接的页面数 / 抽样页面数) × 100%
```

**实现方式**：
- 采用抽样检测（默认10%，最多50页）
- 获取页面 blocks 内容
- 统计 `mention` 类型的 rich_text（page/database mention）

**为什么使用抽样**：
- 获取页面内容需要额外 API 调用
- 每个页面需要 1 次请求
- 抽样可控制 API 调用量和运行时间

---

### 6. 综合健康度 (Health Score)

**定义**：加权综合评分，提供知识库健康状况的整体视图。

**计算公式**：
```
健康度 = 新鲜度 × 0.35 + 活跃度 × 0.30 + 完整度 × 0.20 + 组织度 × 0.15

其中：
- 新鲜度 = 100 - 时间衰减熵
- 活跃度 = min(100, 30天活跃率 × 2)
- 完整度 = 属性完整度
- 组织度 = 分类覆盖率
```

**评级**：
| 分数 | 等级 | 状态 |
|------|------|------|
| 80-100 | A | 🟢 健康 |
| 60-80 | B | 🟡 良好 |
| 40-60 | C | 🟠 一般 |
| 0-40 | D | 🔴 需要整理 |

---

## 📁 项目结构

```
notion_entropy/
├── notion_entropy_checker.py   # 主程序入口
├── notion_api_client.py        # Notion API 客户端封装
├── data_collector.py           # 数据采集模块
├── entropy_calculator.py       # 熵指标计算模块
├── report_generator.py         # 报告生成模块
├── requirements.txt            # Python 依赖
├── .env                        # 环境变量配置（需自行创建）
├── report/                     # 报告输出目录
│   └── entropy_report_*.md
└── README.md
```

---

## ⚙️ 配置说明

| 配置项 | 必需 | 默认值 | 说明 |
|-------|------|-------|------|
| `NOTION_TOKEN` | ✅ | - | Notion Integration Token |
| `DATABASE_IDS` | ❌ | 空（全部） | 指定数据库ID，逗号分隔 |
| `TIME_DECAY_THRESHOLD_DAYS` | ❌ | 30 | 时间衰减阈值（天） |
| `TIME_DECAY_WARNING_THRESHOLD` | ❌ | 40 | 警告阈值（%） |

---

## 🔄 定时运行

### Windows 任务计划程序

1. 打开"任务计划程序"
2. 创建基本任务
3. 设置触发器（如：每周一）
4. 操作：启动程序 `python`，参数：脚本完整路径

### Linux/Mac Cron

```bash
# 每周一早上9点运行
0 9 * * 1 cd /path/to/notion_entropy && python notion_entropy_checker.py
```

---

## 📝 输出示例

```
============================================================
Notion 数据熵增检测工具
============================================================

🔌 正在连接 Notion API...
✅ 连接成功

📊 正在收集数据...
✅ 找到 36 个数据库

🧮 正在计算熵指标...
📈 正在计算整体指标...

✅ 整体时间衰减熵: 93.62%
✅ 30天活跃率: 6.38%
✅ 属性完整度: 92.73%
✅ 分类覆盖率: 6.29%
✅ 连接密度(抽样): 16.00%
🏥 知识库健康度: 25.6分 (D - 需要整理)

📝 正在生成报告...
✅ 报告已保存: report/entropy_report_20251129_105142.md
```

---

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

## 📄 License

MIT License
